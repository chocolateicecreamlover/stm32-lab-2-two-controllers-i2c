# Connect two stm32 via I2C

Задачи:

- Соединить два микроконтроллера через шину I2C, наладить передачу данных
- Разделить работу с гироскопом L3GD20 и с выводом данных на светодиодную матрицу на разные микроконтроллеры: получение и обработка данных с гироскопа на одном, вывод изображения на светодиодную матрицу на другом.

Для работы используются два микроконтроллера на отладочных платах STM32F411 Discovery kit (№1) и STM32 NUCLEO-F429ZI (№2). 
Микроконтроллер №1 работает на тактовой частоте 100 МГц, как и в [первой лабораторной работе](https://github.com/chocolateicecreamlover/stm32-lab-1-sliding-dot). 
Микроконтроллер №2 работает на частоте 16 МГц.

Назначение портов ввода-вывода микроконтроллера на отладочной плате STM32F411 Discovery kit:

![Назначение портов ввода-вывода микроконтроллера на отладочной плате STM32F411 Discovery kit](https://github.com/chocolateicecreamlover/stm32-lab-2-two-controllers-i2c/assets/152575505/a9246113-7dab-4ad2-ba00-de4cdf147ec6)


Назначение портов ввода-вывода микроконтроллера на отладочной плате STM32 NUCLEO-F429ZI:

![Назначение портов ввода-вывода микроконтроллера на отладочной плате STM32 NUCLEO-F429ZI](https://github.com/chocolateicecreamlover/stm32-lab-2-two-controllers-i2c/assets/152575505/477d64da-056a-4248-adb3-454ce95fb84b)

На обоих микроконтроллерах инициализируются интерфейсы I2C и SPI.
На микроконтроллере №1:

- SPI1: режим работы Full-Duplex Master, размер передаваемых данных 8 бит, скорость обмена 1 Мбит/с. Используется для работы с гироскопом L3GD20.
- I2C1: стандартные настройки. Master. Разрешение обоих прерываний. GPIO pull up на пинах, ответственных за SDA, SCL. Используется для передачи данных на второй микроконтроллер.

На микроконтроллере №2:

- SPI1: режим работы Master Transmit, размер передаваемых данных 8 бит, скорость обмена 1 Мбит/с. Используется для вывода изображения на светодиодную матрицу разрешением 32х16 точек.
- I2C1: slave. Aдрес устройства в 7-битном формате 0х10. Разрешение обоих прерываний. GPIO pull up на пинах, ответственных за SDA, SCL. Используется для принятия данных с первого микроконтроллера.

Важно: для интерфейса I2C важно, чтобы линии SDA и SCL были подтянуты на положительное напряжение. 
В данной работе это реализуется с помощью GPIO Pullup.

Демонстрация работы:

https://github.com/chocolateicecreamlover/stm32-lab-2-two-controllers-i2c/assets/152575505/8fd9459d-a35c-4b6b-a30d-d2af3ace558e

## Как пользоваться
- По отедльности открыть CubeMX проект для Core_Master и Core_Slave
- Сгенерировать код для IDE, которой пользуетесь
- Настроить все зависимости между файлами
- Прошить отдельно каждый микроконтроллер
- Без питания подключить все компоненты
- Включить питание, наблюдать работу
